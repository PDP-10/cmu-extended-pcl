REDIT 1(103) COMPARE by user PA0B, 22-Nov-82 23:48:01
File 1: PK:<PA0B>EXEC0.MAC.1
File 2: PK:<PA0B>EXEC0.MAC.2
***** CHANGE #1; PAGE 1, LINE 1; PAGE 1, LINE 1
 ---------------------------------
;<5.PCL>EXEC0.MAC.2, 21-Nov-82 00:55:52, Edit by PA0B
;CM156 Clear CIPF later (after CIN1) so DOCOMMAND "kept-fork-name" works.
;CM156 Fix ORIGINAL <esc> ^U to not leave the doing-an-original-command
; flag set.

***** CHANGE #2; PAGE 10, LINE 66; PAGE 10, LINE 66
>
	CALL RLJFNS		;RELEASE ANY JFNS USED IN PREVIOUS COMMAND
				;NOTE:  RLJFNS CALLED HERE RATHER THAN EARLIER
				;TO FLUSH JFN USED BY MWATCH.  THIS IS NECESSARY
				;SO THAT "COPY TTY:$" DOESN'T TYPE "MAIL"!
	SETZM CIPF		;SAY NO COMMAND IN PROGRESS
	SETOM CLF		;SAY WE'RE AT COMMAND LEVEL
 ---------------------------------
>
	CALL RLJFNS		;RELEASE ANY JFNS USED IN PREVIOUS COMMAND
				;NOTE:  RLJFNS CALLED HERE RATHER THAN EARLIER
				;TO FLUSH JFN USED BY MWATCH.  THIS IS NECESSARY
				;SO THAT "COPY TTY:$" DOESN'T TYPE "MAIL"!
;CM156	SETZM CIPF		;SAY NO COMMAND IN PROGRESS
	SETOM CLF		;SAY WE'RE AT COMMAND LEVEL

***** CHANGE #3; PAGE 10, LINE 80; PAGE 10, LINE 80
	MOVEI Z,0		;CLEAR FLAGS

;BEGIN INPUTTING AND DECODING A COMMAND

	CALL COMSET		;SET UP THINGS FOR COMMAND INPUT
CIN1:	MOVX B,WHLU+OPRU+ERRU	;PCL
	SKIPE PRVENF		;USER "ENABLE"D?
 ---------------------------------
	MOVEI Z,0		;CLEAR FLAGS

;BEGIN INPUTTING AND DECODING A COMMAND

	CALL COMSET		;SET UP THINGS FOR COMMAND INPUT
	MOVE B,PCLDCO		;CM156 Get default value for Original flag
				; (0 unless from DOCOMMAND ORIGINAL "...")
	MOVEM B,ORIFLG		;CM156 Set Original flag (here because after
				; reparse address but before entry from
				; the "Original" command.
CIN1:	SETZM CIPF		;CM156 No command in progress yet
	MOVX B,WHLU+OPRU+ERRU	;PCL
	SKIPE PRVENF		;USER "ENABLE"D?

***** CHANGE #4; PAGE 10, LINE 97; PAGE 10, LINE 103
CIN7:	SKIPN PCFLDB		;IS PCL A FACTOR?
	SKIPE PCFLDP
	TRNA			;YES
	JRST CIN10		;NO
	MOVEI C,PCFLDB		;ASSUME USER TABLE
	SKIPN PCLDCO		;DOES HE WANT THE ORIGINAL SET?
	SKIPN PCFLDB		;DOES HE HAVE HIS OWN?
 ---------------------------------
CIN7:	SKIPN PCFLDB		;IS PCL A FACTOR?
	SKIPE PCFLDP
	TRNA			;YES
	JRST CIN10		;NO
	MOVEI C,PCFLDB		;ASSUME USER TABLE
	SKIPN ORIFLG		;CM156 DOES HE WANT THE ORIGINAL SET?
	SKIPN PCFLDB		;DOES HE HAVE HIS OWN?

***** CHANGE #5; PAGE 10, LINE 104; PAGE 10, LINE 110
	TRNA			;YES, OR NO
	JRST CIN8		;NO AND YES, USE HIS
	SKIPN PCFLDP		;IS THERE A PRESERVED TABLE?
	JRST CIN10		;NO, USE ORIGINAL ONE
	SKIPLE PCLDCO		;USE PRESERVED COMMANDS?
	JRST CIN10		;NO, USE ORIGINAL ONE
 ---------------------------------
	TRNA			;YES, OR NO
	JRST CIN8		;NO AND YES, USE HIS
	SKIPN PCFLDP		;IS THERE A PRESERVED TABLE?
	JRST CIN10		;NO, USE ORIGINAL ONE
	SKIPLE ORIFLG		;CM156 USE PRESERVED COMMANDS?
	JRST CIN10		;NO, USE ORIGINAL ONE

***** CHANGE #6; PAGE 16, LINE 13; PAGE 16, LINE 13
>

;PCL Original Exec command

.ORIGI::NOISE (EXEC COMMAND)
	SETOM PCLDCO		;NEXT COMMAND USES ORIGINAL TABLE
	JRST CIN1		;PARSE AS IF REGULAR COMMAND
 ---------------------------------
>

;PCL Original Exec command

.ORIGI::NOISE (EXEC COMMAND)
	SETOM ORIFLG		;CM156 NEXT COMMAND USES ORIGINAL TABLE
	JRST CIN1		;PARSE AS IF REGULAR COMMAND

